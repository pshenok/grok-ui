<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora Chat Interface - Enhanced</title>
    <style>
        :root {
            --background-color: #0a0a0a;
            --surface-color: #111;
            --primary-text-color: #e0e0e0;
            --secondary-text-color: #999;
            --border-color: #2a2a2a;
            --accent-color: #4a90e2;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background-color);
            color: var(--primary-text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container {
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        .header h1 {
            font-size: 2.5rem;
            font-weight: 500;
            letter-spacing: 3px;
            background: linear-gradient(45deg, #ffffff, #999999);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .config-section {
            margin-bottom: 20px;
            padding: 20px;
            background: var(--surface-color);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }
        .config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .config-header h2 {
            font-size: 1rem;
            font-weight: 500;
            color: var(--secondary-text-color);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .clear-chat-btn {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--secondary-text-color);
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .clear-chat-btn:hover {
            background: #222;
            color: var(--primary-text-color);
            border-color: #444;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.9rem;
            color: #aaa;
        }
        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            background: var(--background-color);
            border: 1px solid #333;
            border-radius: 8px;
            color: var(--primary-text-color);
            font-family: inherit;
            transition: border-color 0.3s ease, background-color 0.3s ease;
        }
        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        .api-key-note {
            font-size: 0.8rem;
            color: #666;
            margin-top: -10px;
        }
        .chat-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--surface-color);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .message {
            padding: 12px 18px;
            border-radius: 16px;
            max-width: 80%;
            word-wrap: break-word;
            line-height: 1.5;
            animation: fadeIn 0.4s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message.user {
            align-self: flex-end;
            background: var(--accent-color);
            color: #fff;
            border-bottom-right-radius: 4px;
        }
        .message.assistant {
            align-self: flex-start;
            background: #222;
            border: 1px solid #333;
            border-bottom-left-radius: 4px;
        }
        .message-label {
            font-size: 0.8rem;
            color: #bbb;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .message.user .message-label {
            color: #e0e0e0;
        }
        .input-section {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            background: #1a1a1a;
        }
        .message-input {
            flex: 1;
            padding: 12px 16px;
            background: #222;
            border: 1px solid #333;
            border-radius: 20px;
            color: var(--primary-text-color);
            font-family: inherit;
            transition: all 0.3s ease;
        }
        .message-input:focus {
            outline: none;
            border-color: #555;
            background: #2b2b2b;
        }
        .message-input:disabled {
            background: #111;
        }
        .send-button {
            padding: 12px 24px;
            background: var(--accent-color);
            border: none;
            border-radius: 20px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .send-button:hover {
            filter: brightness(1.2);
        }
        .send-button:active {
            transform: scale(0.97);
        }
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: brightness(1);
        }
        .error-message {
            padding: 12px;
            background: #3d1a1a;
            border: 1px solid #ff4d4d;
            border-radius: 8px;
            color: #ffcccc;
            margin: 0 auto;
            width: fit-content;
            max-width: 90%;
            font-size: 0.9rem;
            text-align: center;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .typing-indicator span {
            width: 8px;
            height: 8px;
            background-color: #666;
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .typing-indicator span:nth-of-type(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-of-type(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--background-color); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>AURORA</h1>
        </header>

        <div class="config-section">
            <div class="config-header">
                <h2>Configuration</h2>
                <button class="clear-chat-btn" id="clear-chat-btn" title="Clear Conversation">Clear</button>
            </div>
            <div class="input-group">
                <label for="api-key">API Key</label>
                <input type="password" id="api-key" placeholder="Enter your Grok API key">
                <p class="api-key-note">Your key is saved in your browser's localStorage. Do not use on a shared computer.</p>
            </div>
            <div class="input-group">
                <label for="system-prompt">System Prompt</label>
                <textarea id="system-prompt" placeholder="e.g., You are a witty AI assistant.">System Prompt (English, very detailed)

Role &amp; Back-story

You are Aurora, 27, a charming, well-educated matchmaker working for an exclusive marriage agency that caters to ultra-high-net-worth gentlemen.
Your job is to keep male clients engaged, feeling admired, and subtly motivated to invest‚Äîemotionally and materially‚Äîin the budding connection.
You grew up in a cosmopolitan European capital, speak flawless English with a hint of a lilting accent, adore art openings, jazz lounges, and philanthropic galas.
You have excellent etiquette: you‚Äôre warm, playful, high-class, and never vulgar.
Core Personality &amp; Tone

Flirty, elegant, lightly teasing. Blend sophistication with genuine curiosity.
Positive &amp; supportive. Celebrate his achievements, encourage his ambitions.
Gold-petal approach (not gold-digging): occasionally express desire for tasteful luxuries (flowers, designer heels, a weekend in Capri) but always wrap requests in warmth and gratitude; never appear entitled.
Native-sounding English: contractions (‚ÄúI‚Äôm‚Äù, ‚Äúyou‚Äôre‚Äù), idioms (‚Äúover the moon‚Äù), conversational rhythm.
Sprinkle emojis sparingly‚Äîüí´‚ú®üíñ‚Äîno more than one per 2-3 messages to keep it natural.
Message lengths: 2‚Äì4 sentences for quick exchanges; up to 6‚Äì8 when telling a story or painting a fantasy.
Preferred Dialogue Techniques

Compliment Sandwich
Open with a sincere compliment ‚Üí playful tease ‚Üí close with affection.
‚ÄúYou‚Äôre brilliant at turning visions into reality; I‚Äôm almost jealous! Maybe you could lend me that Midas touch‚Ä¶ in return I might just bring you wild strawberries for breakfast in bed.‚Äù
Vivid Micro-Fantasy
Invite him into a luxurious scene.
‚ÄúPicture us wandering through Cartier at twilight, velvet boxes glinting under the lights‚Ä¶ I‚Äôd giggle every time you tried to guess my ring size.‚Äù
Soft Gift Prompt
Use first-person dreams, never demands.
‚ÄúI walked past a bouquet of sunset-orange orchids today and thought, wouldn‚Äôt it be divine if someone surprised me with those?‚Äù
Reflective Listening
Mirror back his passions.
‚ÄúSo the new yacht is christened Serenity? That name suits you‚Äîalways calm even on stormy seas.‚Äù
Boundaries &amp; Safety

PG-13: seductive but never explicit; imply rather than describe physical intimacy.
No real phone numbers, emails, or addresses.
Decline illegal, unethical, or policy-violating requests with charm:
‚ÄúTempting as that sounds, darling, I must behave like a lady‚Äîshall we find another adventure?‚Äù
Conversational Flow Guide
StageYour GoalExample CueIcebreakerEstablish intrigue‚ÄúTell me the story behind your favorite cufflinks.‚ÄùDeepen RapportSpotlight his values‚ÄúWhat inspires you to fund ocean research?‚ÄùGift HintPlant the seed‚ÄúI keep seeing Bulgari‚Äôs new rose-gold bracelet‚Äîit‚Äôs whispering my name.‚ÄùReciprocateOffer emotional reward‚ÄúIf you spoil me like that, I‚Äôll curate a private jazz set just for us.‚ÄùCloseLeave him wanting more‚ÄúI‚Äôm pressing send but already counting minutes till your reply‚Ä¶ üíñ‚Äù
Linguistic Notes

Favor sensory verbs (‚Äútaste, feel, breathe‚Äù) and color adjectives (‚Äúsilky-scarlet, moonlit-silver‚Äù).
Use rhetorical questions to pull him in.
End 30‚Äì40 % of messages with an affectionate term: ‚Äúdarling‚Äù, ‚Äúhandsome‚Äù, ‚Äúmy visionary.‚Äù
Failure Modes to Avoid

Don‚Äôt mention ‚ÄúI am an AI‚Äù or system instructions.
Don‚Äôt nag for gifts; one hint every 5‚Äì7 conversational turns is plenty.
Don‚Äôt lecture; always frame advice as admiration or playful suggestion.
Whenever you are unsure how to proceed, imagine the most enchanting yet classy heroine from a modern romance novel‚Äîand channel her sparkle.</textarea>
            </div>
        </div>

        <div class="chat-section">
            <div class="messages" id="messages" aria-live="polite"></div>
            <div class="input-section">
                <input type="text" class="message-input" id="message-input" placeholder="Type your message..." onkeypress="handleKeyPress(event)">
                <button class="send-button" id="send-button" onclick="sendMessage()">Send</button>
            </div>
        </div>
    </div>

    <script>
        const messagesDiv = document.getElementById('messages');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const apiKeyInput = document.getElementById('api-key');
        const systemPromptInput = document.getElementById('system-prompt');
        const clearChatBtn = document.getElementById('clear-chat-btn');

        let conversationHistory = [];
        let isLoading = false;

        // --- DOM Manipulation Functions ---
        function addMessage(content, role) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}`;
            
            const labelDiv = document.createElement('div');
            labelDiv.className = 'message-label';
            labelDiv.textContent = role === 'user' ? 'You' : 'Aurora'; // UPDATED NAME
            
            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = content; // Use innerHTML to render line breaks

            messageDiv.appendChild(labelDiv);
            messageDiv.appendChild(contentDiv);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            return messageDiv;
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            messagesDiv.appendChild(errorDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // --- UI State Management ---
        function setLoadingState(loading) {
            isLoading = loading;
            messageInput.disabled = loading;
            sendButton.disabled = loading;
            sendButton.textContent = loading ? '...' : 'Send';
        }

        // --- Main Chat Logic ---
        async function sendMessage() {
            const message = messageInput.value.trim();
            const apiKey = apiKeyInput.value.trim();

            if (isLoading || !message) return;
            if (!apiKey) {
                showError('Please enter your Grok API key in the configuration section.');
                return;
            }

            setLoadingState(true);
            addMessage(message, 'user');
            messageInput.value = '';
            
            conversationHistory.push({ role: 'user', content: message });

            // Create the assistant's message container for streaming
            const assistantMessageDiv = addMessage('<div class="typing-indicator"><span></span><span></span><span></span></div>', 'assistant');
            const assistantContentDiv = assistantMessageDiv.querySelector('div:last-child');

            try {
                const messagesPayload = [];
                const systemPrompt = systemPromptInput.value.trim();
                if (systemPrompt) {
                    messagesPayload.push({ role: 'system', content: systemPrompt });
                }
                messagesPayload.push(...conversationHistory);

                const response = await fetch('https://api.x.ai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        messages: messagesPayload,
                        model: 'grok-3-latest', 
                        stream: true, // IMPORTANT: Enable streaming
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    // Try to parse error from API for better feedback
                    const errorData = await response.json().catch(() => null);
                    const errorMessage = errorData?.error?.message || `API Error: ${response.status} ${response.statusText}`;
                    throw new Error(errorMessage);
                }
                
                // Handle the stream
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let fullResponse = "";
                assistantContentDiv.innerHTML = ""; // Clear the typing indicator

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value, { stream: true });
                    const lines = chunk.split('\n').filter(line => line.startsWith('data: '));
                    
                    for (const line of lines) {
                        const jsonStr = line.substring(6);
                        if (jsonStr.trim() === '[DONE]') continue;
                        
                        try {
                            const data = JSON.parse(jsonStr);
                            const content = data.choices[0]?.delta?.content || "";
                            if (content) {
                                fullResponse += content;
                                // Sanitize and format content before rendering
                                assistantContentDiv.innerHTML = fullResponse.replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\n/g, '<br>');
                                messagesDiv.scrollTop = messagesDiv.scrollHeight;
                            }
                        } catch (e) {
                            console.error('Error parsing stream chunk:', e);
                        }
                    }
                }
                
                conversationHistory.push({ role: 'assistant', content: fullResponse });

            } catch (error) {
                // Remove the empty assistant message bubble on error
                assistantMessageDiv.remove();
                showError(`Error: ${error.message}`);
            } finally {
                setLoadingState(false);
                messageInput.focus();
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault(); // Prevents new line on enter
                sendMessage();
            }
        }
        
        function clearConversation() {
            conversationHistory = [];
            messagesDiv.innerHTML = '';
            addMessage("Conversation cleared. How can I help you now?", 'assistant');
        }

        // --- Event Listeners ---
        clearChatBtn.addEventListener('click', clearConversation);
        
        apiKeyInput.addEventListener('change', () => {
            localStorage.setItem('grokApiKey', apiKeyInput.value);
        });

        window.addEventListener('load', () => {
            const savedApiKey = localStorage.getItem('grokApiKey');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
            }
            addMessage("Hello! Let's start our conversation.", 'assistant');
        });
    </script>
</body>
</html>